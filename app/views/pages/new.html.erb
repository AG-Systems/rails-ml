
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <!-- <span class="close">&times;</span> -->
    <img src="https://s3-us-west-1.amazonaws.com/techauriga/static_img/loading1.gif" id="loading-gif" class="img-responsive" style="margin: 0 auto;"/>
    <div class="container-images" class="img-responsive" style="text-align: center; width: 70%; margin: 0 auto; background-color: transparent; color: white;">
                <h3>Your ad is being processed</h3>
                <p>Please wait 1-2 minutes</p>
                <p>Do not <b>refresh</b> the page</p>
    </div>
  </div>

</div>
        <div>
      <%= form_for(@ad, :html => {:id => "testupload"}) do |f| %>

            <div class="card-images previews">
         <ul>
            <% @ad.errors.full_messages.each do |error| %>
               <li class="alert alert-danger card-images"><%= error %></li>
            <% end %>
         </ul>               
                        <div style="width: 100%; height: 150px; background-color: #939393;" class="details">
                           <div style="text-align: center; color: white; line-height: 150px; font-size: 25px;">Drag and drop image(alpha)</div>
                        </div>
                <div class="container-images">
                 <div style="text-align: center;">
                     <label class="btn btn-info btn-file" style="text-align: center; width: 75%;">
                        Browse files
                      <%= f.file_field :image, accept:'image/*', :style => "display: none", :id =>"my-file-selector", :required => true, onChange:"load_image(this.id,this.value)" %>
                      <% if f.object.image? %>
                        <%= image_tag f.object.image.thumb.url %>
                        <%= f.label :remove_image %>
                        <%= f.check_box :remove_image %> 
                      <% end %>    
                      </label>
                      <div>
                          File name:
                    <div style="text-align: center;">
                     <input type="text" id="upload-file-info" style="border: none;background-color: transparent; text-align:center;" readonly/> 
                    </div>
                      </div>
                  </div>
                    <h3><%= f.text_field :title, class: "input-max", :required => true, placeholder:"Title of your ad", :autocomplete => :off, :maxlength => 35  %></h3>
                    <div id="input-valid"></div>
										<p><b>Feedback: </b></p>
										<p style="font-size: 16px">Your feedback and info goes here</p>
                    <hr/>
                    <!--
                    <p><b>Image Recognition:</b></p>
						<p style="font-size: 16px">See how recognizable your image is</p>
						<p style="font-size: 16px">Shows the top 5 guesses</p>
                    <hr/>
                    -->
                    <p>Rating: 10/10</p>
                    <p style="font-size: 16px">Anything above 5 is good</p>
                    <p style="font-size: 16px">Anything below 5 is bad</p>   
                  <br/>
                  <div style="text-align: center;">
                      <% if current_user.ready %>
                          <% if current_user.limit > 0 || current_user.subscribed %>
                              <%= f.submit "Submit ad", :class => 'btn btn-success', :style => "width: 75%", data: { disable_with: "Please wait..." } %>
                          <% else %>
                              <button type="button" class="btn btn-danger disabled">You are out of uploads for this month</button>
                         <% end %>
                      <% else %>
                         <button type="button" class="btn btn-danger disabled">Please wait for your previews ad to finish</button>
                      <% end %>
                  </div>
                  <br/>
                </div>
            </div>
         <%= f.hidden_field :author, value: current_user.email %>
         <% end %>
        </div>
<script type="text/javascript">
    function valid_title() 
    {
        
        var x, text;
        alert();
        // Get the value of the input field with id="numb"
        x = document.getElementsByClassName("input-max").value;
        text = "Only Alphabetic and number characters are allowed";
        if(/\A[a-zA-Z0-9]*\z/).test(x))
        {
            alert();
        }
        else
        {
           // document.getElementById("demo").innerHTML = text;
           document.getElementById("input-valid").innerHTML = text;
           alert();
        }
    } 
</script>
<script>
    $('#my-file-selector').on('change',function(){
          $('#upload-file-info').val(this.files && this.files.length ?
          this.files[0].name : this.value.replace(/^C:\\fakepath\\/i, ''))
          var img_size = this.files[0].size / 10000;
          console.log(img_size);
          if(img_size > 370000)
          {
               alert("File is too big!");
               $("#upload-file-info").val('');
               this.value = "";
          };         
          
        })
</script>

<script type="text/javascript">
function load_image(id,ext)
{
   if(validateExtension(ext) == false)
   {
      alert("Must be an image file: jpg, jpeg, png, or gif");
      // document.getElementById("upload-file-info").focus();
      $("#my-file-selector").replaceWith($("#my-file-selector").val('').clone(true));
      $("#my-file-selector").val('');
      $("#upload-file-info").val('');
      return;
   }
}

function validateExtension(v)
{
      var allowedExtensions = new Array("jpg","JPG","jpeg","JPEG", "PNG", "png", "GIF", "gif");
      for(var ct=0;ct<allowedExtensions.length;ct++)
      {
          sample = v.lastIndexOf(allowedExtensions[ct]);
          if(sample != -1){return true;}
      }
      return false;
}

</script>

<script>
    $(".btn-success").click(function()
    {
        
        if($("#upload-file-info").val() !== "" && $(".input-max").val() !== "")
        {
            var modal = document.getElementById('myModal');
            $("#myModal").fadeIn(500).css("display","block");
            // modal.style.display = "block";
        }
    });
    
</script>
